#!/usr/bin/env ruby
require 'rubygems'
$LOAD_PATH << File.join(File.dirname(__FILE__), '../lib')
require 'pbr'

# borrowed from beefcake

File.write('/home/pwinton/pb.dat', STDIN.read)

ns = (ENV['PBR_NAMESPACE'] || '').split('::')

pbr = Pbr.new(PbrRule.vanilla)
req = pbr.read(STDIN.read, CodeGeneratorRequest)
compiled = Pbr::Generator.compile(ns, req)
res = pbr.write(compiled, CodeGeneratorResponse)
STDOUT.print(res.encode)
